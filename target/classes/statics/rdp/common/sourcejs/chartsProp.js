var chartstool=function(event,opt){var cells=hot.Methods.getSelected(),metaData=hot.Methods.getCellMeta(cells[0][0],cells[0][1]),celldom=hot.Methods.getCell(cells[0][0],cells[0][1]),getOptions=function(){return metaData.charts.option},getOptionsKey=function(t,a,e){var n;if(a&&t){var i=a.split(".");if((n=t[i[0]])&&1<i.length){var o=a.substring(a.indexOf(".")+1,a.length);"[object Array]"===Object.prototype.toString.apply(n)?n=getOptionsKey(n[e],o):"[object Object]"===Object.prototype.toString.apply(n)&&(n=getOptionsKey(n,o,e))}}return n},setOption=function(t){var a=metaData.charts;a.option=t,hot.Methods.setCellMeta(cells[0][0],cells[0][1],"charts",a),createChartsTag($(celldom).find(".charts-tag"),t.options,t.theme)},getConfig=function(t){return getAjaxJsonFile("../../statics/rdp/common/sourcejs/charts_config/"+t)},getAjaxJsonFile=function(t){var a;return $.ajax({url:t,type:"GET",async:!1,dataType:"json",success:function(t){a=t}}),a},setOptionProp=function(t,a,e,n){if(!a)return t;var i=a.split(".");t||(t={}),t[i[0]]||(t[i[0]]={});var o=t[i[0]];if(1<i.length){var l=a.substring(a.indexOf(".")+1,a.length);"[object Array]"===Object.prototype.toString.apply(o)?o[n=n||0]=setOptionProp(o[n],l,e):"[object Object]"===Object.prototype.toString.apply(o)&&(o=setOptionProp(o,l,e,n)),t[i[0]]=o}else t[a]=e;return t};function isNumber(t){return"number"==typeof t&&!isNaN(t)}function isArray(t){return"[object Array]"===Object.prototype.toString.apply(t)}function isObjecty(t){return"[object Object]"===Object.prototype.toString.apply(t)}var delOptionProp=function(t,a,e){if(a){var n=a.split(".");if(t[n[0]]){var i=t[n[0]];if(1<n.length){var o=a.substring(a.indexOf(".")+1,a.length);"[object Array]"===Object.prototype.toString.apply(i)?i[e]=delOptionProp(i[e],o):"[object Object]"===Object.prototype.toString.apply(i)&&(i=delOptionProp(i,o,e))}else delete t[n[0]]}}return t},updateProp=function(l,s){var p=getOptions();event.find(".tag-data").each(function(t,a){var e=$(a);if(e.data("prop")==l.data("prop")&&e.data("index")==l.data("index")){var n=e.data("prop"),i=e.data("pval"),o=(e.data("usable"),e.data("index"));void 0===s&&(s=!0,l.data("usable",!0),setTagState(l,!0)),p=s?setOptionProp(p,n,i,o):delOptionProp(p,n,o)}}),setOption(p)},setTagState=function(a,t,e){var n=a.find(".tag-state .fa"),i=function(t){e&&e.call(this,a,t)};t?(n.removeClass("fa-square-o"),n.addClass("fa-check-square-o"),a.addClass("on"),i("on")):(n.removeClass("fa-check-square-o"),n.addClass("fa-square-o"),a.removeClass("on"),i("off"))},create_tag=function(t,a){var e=$('<li class="tag-data"></li>');return e.append('<div class="tag-state"><i class="fa fa-square-o"></i></div>'),e.append('<div class="tag-title"><span></span></div>'),e.append('<div class="tag-widget"></div>'),e.find(".tag-title span").text(t),e.find(".tag-state .fa").bind("click",function(){setTagState(e,$(this).hasClass("fa-square-o"),a)}),e},usable=function(t,a){"off"==a?(updateProp(t,!1),$(t).data("usable",!1)):(updateProp(t,!0),$(t).data("usable",!0))},setDefault=function(t,a,e,n){return t.data("prop",a),t.data("pval",n),t.data("usable",!1),t.data("index",e),n&&t.data("usable",!0),t},lineTag=function(t,a){var e=$('<li class="tag-decollate"><span class="decollate_line"></span></li>');t.append(e)},titleTag=function(t,a){var e=a.name,n=a.index,i=$('<li class="tag-decollate"><span class="decollate_title">标题</span></li>');i.find(".decollate_title").text(e),void 0!==n&&i.find(".decollate_title").text(e+"-"+n),t.append(i)},inputTag=function(t,a){var e=a.name,n=a.prop,i=create_tag(e,usable),o=a.index;i=setDefault(i,n,o),t.append(i);var l=i.find(".tag-widget"),s=$('<input class="input-tag" type="text">'),p=getOptionsKey(getOptions(),n,o);p&&(s.val(p),setTagState(i,!0)),l.append(s),s.bind("change",function(){var t=$(this).val();i.data("pval",t),updateProp(i)})},radioTag=function(event,config){var name=config.name,prop=config.prop,pram=config.pram,tag=create_tag(name,usable),index=config.index;tag=setDefault(tag,prop,index),event.append(tag);var widget=tag.find(".tag-widget"),ul=$('<ul class="plug_radio"></ul>'),tagVal=getOptionsKey(getOptions(),prop,index);if(pram){var evalVal=function(val){return"false"==val||"true"==val?eval(val):val},prams=pram.split("|");$.each(prams,function(t,a){var e=a.split("-")[0],n=a.split("-")[1],i=$("<li></li>");i.attr("data-val",n),i.text(e),null!=tagVal&&evalVal(n)==tagVal&&(i.addClass("on"),setTagState(tag,!0)),ul.append(i)}),widget.append(ul),tag.append(widget),ul.find("li").bind("click",function(){$(this).siblings().removeClass("on"),$(this).addClass("on");var t=$(this).attr("data-val");tag.data("pval",evalVal(t)),updateProp(tag)})}},colorTag=function(t,a){var e=a.name,n=a.prop,i=(a.pram,create_tag(e,usable)),o=a.index;i=setDefault(i,n,o),t.append(i);var l=i.find(".tag-widget"),s=$('<span class="color-tag"><span class="color-span"></span></span>');l.append(s);var p=getOptionsKey(getOptions(),n,o);isArray(p)&&(p=p[0]),p&&(s.find(".color-span").css("background-color",p),setTagState(i,!0)),s.spectrum({showInput:!0,allowEmpty:!0,showAlpha:!1,showPalette:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,cancelText:"取消",chooseText:"确认",togglePaletteMoreText:"更多",togglePaletteLessText:"简略",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(t){var a=t.toRgbString();s.find(".color-span").css("background-color",a),i.data("pval",a),updateProp(i)},show:function(t){},move:function(t){}})},selectTag=function(t,a){a.name,a.prop,a.pram},sliderTag=function(t,a){var e=a.name,n=a.prop,i=(a.pram,create_tag(e,usable)),o=a.index;i=setDefault(i,n,o),t.append(i);var l=i.find(".tag-widget"),s=$('<span class="slider-tag"></span>');l.append(s);var p=$('<input class="slider-input" type="number">');l.append(p);var r={change:function(t,a){},slide:function(t,a){var e=Number(a.value);p.val(a.value),i.data("pval",e),updateProp(i)}},c=getOptionsKey(getOptions(),n,o);isArray(c)&&(c=c[0]);var d=function(t){return t?isNumber(t)?t:t.split("%")[0]:0};c&&(c=d(c),r.value=d(c),p.val(c),setTagState(i,!0)),s.slider(r),p.bind("change",function(){var t=Number($(this).val());s.slider("option","max")<t&&s.slider("option","max",t),s.slider("value",t),i.data("pval",t),updateProp(i)})},porpLoad=function(t,a){var e=a.propType;"input"==e?inputTag(t,a):"radio"==e?radioTag(t,a):"slider"==e?sliderTag(t,a):"doubleSlider"==e?doubleSliderTag(t,a):"color"==e?colorTag(t,a):"inputBtn"==e?inputBtnTag(t,a):"button"==e?buttonTag(t,a):"line"==e?lineTag(t,a):"title"==e&&titleTag(t,a)},commonConfig=function(){},loadinit=function(){var t=getConfig("configure/"+metaData.charts.type+".json"),p=$('<ul class="btn-list"></ul>'),a=$('<li class="child-attr-btn"></li>'),r=$('<li class="child-attr-context"></li>');a.append(p),event.append(a),event.append(r),$.each(t,function(t,a){var e=a.name,n=a.sort,i=a.props,o=$('<li><span class="btn-text">'+e+"</span></li>");p.append(o);var l=$('<ul class="attr-list"></ul>');if(r.append(l),0==t?(o.addClass("selected"),l.show()):l.hide(),n){var s=getOptionsKey(getOptions(),"options.series");$.each(s,function(t,a){var e=a.type,n=t;$.each(i,function(t,a){a.index=n,null!=a.sortType?a.sortType==e&&porpLoad(l,a):porpLoad(l,a)})})}else $.each(i,function(t,a){porpLoad(l,a)})}),p.find("li").bind("click",function(){$(this).siblings().removeClass("selected"),$(this).addClass("selected");var t=$(this).index(),a=$(this).parents(".attr_context").find(".child-attr-context .attr-list");a.eq(t).show(),a.eq(t).siblings().hide()})};return loadinit(),{}};